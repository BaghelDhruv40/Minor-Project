<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Index Page</title>
		<link
			rel="icon"
			href="https://media.geeksforgeeks.org/wp-content/cdn-uploads/gfg_200X200.png"
			type="image/x-icon" />
		<!-- Bootstrap 4 CSS -->
		<link
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
			rel="stylesheet" />

		<style>
			body {
				font-family: Arial, Helvetica, sans-serif;
				margin: 0;
				padding: 0;
				background-color: aliceblue;
			}
			h1 {
				text-align: center;
				margin-top: 1%;
				font-size: x-large;
				color: #000;
			}
			#upload-form {
				display: flex;
				flex-direction: column;
				align-items: center;
				margin: 5% auto;
				margin-top: 2px;
				width: 300px;
				padding: 80px;
				border: 5px solid #000000;
				border-radius: 1px;
			}

			#upload-form label {
				margin-bottom: 10px;
				font-weight: bold;
			}

			#upload-form input[type="file"] {
				margin-bottom: 10px;
				padding: 10px;
				border: 4px solid #ddd;
				border-radius: 3px;
				width: 100%;
				box-sizing: border-box;
			}

			#upload-form button {
				background-color: #007bff;
				color: white;
				padding: 10px 15px;
				border: none;
				border-radius: 3px;
				cursor: pointer;
				font-size: 16px;
			}

			#upload-form button:hover {
				background-color: #03754f;
			}

			.spinner {
				border: 4px solid rgba(0, 0, 0, 0.1);
				border-left-color: #007bff;
				border-radius: 50%;
				width: 30px;
				height: 30px;
				animation: spin 1s linear infinite;
				margin: 2px auto;
				display: none; /* Hidden by default */
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			#results {
				text-align: center;
				margin-top: 2px;
			}
		</style>
	</head>
	<body>
		<h1>Customer Segmentation App</h1>

		<form id="upload-form" onsubmit="handleSubmit(event)">
			<label for="file-upload">Upload CSV file:</label>
			<input type="file" id="file-upload" />
			<button type="submit">Submit</button>
		</form>

		<div id="spinner" class="spinner"></div>

		<div id="results"></div>
	</body>

	<script>
		function handleSubmit(event) {
			event.preventDefault(); // prevent the form from submitting normally

			var file = document.getElementById("file-upload").files[0];
			var formData = new FormData();

			formData.append("file", file);

			var spinner = document.getElementById("spinner");
			spinner.style.display = "block";

			var xhr = new XMLHttpRequest();
			xhr.open("POST", "/predict");

			xhr.send(formData);
			xhr.onreadystatechange = function () {
				if (xhr.readyState === XMLHttpRequest.DONE) {
					if (xhr.status === 200) {
						document.getElementById("results").innerHTML = ""; // Clear previous results

						var response = JSON.parse(xhr.responseText);

						var amountImg = document.createElement("img");
						amountImg.src = response.amount_img;
						amountImg.style.width = "30%"; // Set the width of the image element

						var freqImg = document.createElement("img");
						freqImg.src = response.freq_img;
						freqImg.style.width = "30%"; // Set the width of the image element

						var recencyImg = document.createElement("img");
						recencyImg.src = response.recency_img;
						recencyImg.style.width = "30%"; // Set the width of the image element

						spinner.style.display = "none";

						var imagesDiv = document.createElement("div");
						imagesDiv.style.display = "flex";
						imagesDiv.style.flexWrap = "wrap";
						imagesDiv.style.marginTop = "2px";
						imagesDiv.style.marginBottom = "20px";
						imagesDiv.style.justifyContent = "space-between";
						imagesDiv.style.alignItems = "center";
						imagesDiv.style.width = "100%";
						imagesDiv.appendChild(amountImg);
						imagesDiv.appendChild(freqImg);
						imagesDiv.appendChild(recencyImg);

						document.getElementById("results").appendChild(imagesDiv);
					} else {
						console.error("Error:", xhr.status, xhr.statusText);
						// Handle the error (e.g., display an error message to the user)
						spinner.style.display = "none"; // Hide spinner
					}
				}
			};
		}
	</script>
</html>
